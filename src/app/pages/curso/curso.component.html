<!-- Página de Curso Individual -->
<div class="curso-container" *ngIf="curso">
  <!-- Grain overlay -->
  <div class="grain-overlay"></div>

  <!-- Navbar -->
  <nav class="navbar">
    <a routerLink="/" class="nav-logo">
      <img src="imagen/logo%20Raplh.PNG" alt="Ralph Cuts" class="nav-logo-img" />
    </a>
    <a routerLink="/productos" class="nav-link">COURSES</a>
  </nav>

  <!-- ============== PANTALLA DE LOGIN ============== -->
  <div class="login-screen" *ngIf="!isAuthenticated && !showWelcome">
    <div class="login-container">
      <div class="login-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
      </div>
      <h2>{{ curso.titulo }}</h2>
      <p class="login-subtitle">Ingresa tus credenciales</p>

      <form class="login-form" (ngSubmit)="login()">
        <div class="input-group">
          <input
            type="text"
            id="username"
            [(ngModel)]="username"
            name="username"
            placeholder="Usuario"
            required
            autocomplete="off"
          />
        </div>

        <div class="input-group">
          <input
            type="password"
            id="password"
            [(ngModel)]="password"
            name="password"
            placeholder="Contraseña"
            required
          />
        </div>

        <div class="login-error" *ngIf="loginError">
          {{ loginError }}
        </div>

        <button type="submit" class="login-btn">ACCEDER</button>
      </form>

      <a href="https://wa.me/51970457642" target="_blank" class="help-link">¿Necesitas ayuda?</a>
    </div>
  </div>

  <!-- ============== PANTALLA DE BIENVENIDA ============== -->
  <div class="welcome-screen" *ngIf="showWelcome">
    <div class="welcome-content">
      <div class="welcome-check">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <h2>BIENVENIDO</h2>
      <p>{{ curso.titulo }}</p>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <!-- ============== CONTENIDO DEL CURSO ============== -->
  <div class="course-main" *ngIf="isAuthenticated">

    <!-- Header -->
    <header class="course-header">
      <div class="header-top">
        <span class="membership-tag">MEMBRESÍA ACTIVA</span>
        <button class="logout-btn" (click)="logout()">SALIR</button>
      </div>
      <h1>{{ curso.titulo }}</h1>
    </header>

    <!-- Secciones Colapsables -->
    <section class="course-sections">

      <!-- TEORÍA -->
      <div class="section-block">
        <div class="section-header" (click)="toggleSection('teoria')">
          <div class="section-info">
            <span class="section-number">01</span>
            <h3>TEORÍA</h3>
          </div>
          <div class="section-meta">
            <span class="video-count">1 video</span>
            <span class="toggle-icon" [class.open]="openSection === 'teoria'">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </span>
          </div>
        </div>
        <div class="section-content" [class.open]="openSection === 'teoria'">
          <div class="video-item" (click)="playVideo(curso.teoria)">
            <div class="video-thumb">
              <img [src]="curso.teoria.thumbnail" [alt]="curso.teoria.titulo" />
              <div class="play-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
              </div>
            </div>
            <div class="video-details">
              <h4>{{ curso.teoria.titulo }}</h4>
              <span class="duration">{{ curso.teoria.duracion }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PRÁCTICA -->
      <div class="section-block">
        <div class="section-header" (click)="toggleSection('practica')">
          <div class="section-info">
            <span class="section-number">02</span>
            <h3>PRÁCTICA</h3>
          </div>
          <div class="section-meta">
            <span class="video-count">{{ curso.practicas.length }} videos</span>
            <span class="toggle-icon" [class.open]="openSection === 'practica'">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </span>
          </div>
        </div>
        <div class="section-content" [class.open]="openSection === 'practica'">
          <div class="video-item" *ngFor="let video of curso.practicas; let i = index" (click)="playVideo(video)">
            <div class="video-thumb">
              <img [src]="video.thumbnail" [alt]="video.titulo" />
              <span class="video-num">{{ i + 1 }}</span>
              <div class="play-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
              </div>
            </div>
            <div class="video-details">
              <h4>{{ video.titulo }}</h4>
              <span class="duration">{{ video.duracion }}</span>
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- Footer -->
    <footer class="footer">
      <p>© 2025 Ralph Cuts Academy</p>
    </footer>
  </div>
</div>

<!-- Video Modal -->
<div class="video-modal" *ngIf="showVideoModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div class="video-wrapper">
      <iframe
        *ngIf="selectedVideo"
        [src]="selectedVideo.videoUrl | safeUrl"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>
    <div class="modal-info" *ngIf="selectedVideo">
      <h3>{{ selectedVideo.titulo }}</h3>
      <span>{{ selectedVideo.duracion }}</span>
    </div>
  </div>
</div>

<!-- No encontrado -->
<div class="not-found" *ngIf="!curso">
  <h2>Curso no encontrado</h2>
  <a routerLink="/productos">Volver</a>
</div>
